{% extends 'MondelCuentaloBundle::layout.html.twig' %}

{% block stylesheets %}

    {{ parent() }}

    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset('bundles/mondelcuentalo/css/index.css') }}" />

{% endblock %}

{% block title %} Portada {% endblock %}

{% block top %}

    <div class="Wrap">

        <div id="content_top">

            <div id="logo">
                <img src="{{ asset('bundles/mondelcuentalo/img/logo_cuentalo.gif') }}">
            </div>

            <div id="menu_top">
                <div id="content_menu_top">
                    {% if not is_granted('IS_AUTHENTICATED_FULLY') %}
                         {% include 'MondelCuentaloBundle:Usuario:login.html.twig' %}
                    {% endif %}
                </div>
            </div>

        </div>

    </div>

{% endblock %}

{% block left %}

    <ul id="menu">
        <li><a href="#">Todos</a></li>
        <li><a href="{{ path('vista_secretos') }}">Secretos</a></li>
        <li><a href="{{ path('vista_anecdotas') }}">Anecdotas</a></li>
        <li><a href="{{ path('vista_mensajes') }}">Mensajes</a></li>
        {% if not is_granted('IS_AUTHENTICATED_FULLY') %}
            <li><a href="{{ path('registro') }}">Registrarse</a></li>
        {% else %}
            <li><a href="{{ path('logout') }}">Salir</a></li>
        {% endif %}
    </ul>

{% endblock %}

{% block center %}

    <div class="Wrap">
        <div id="Error">
            {{ form_errors(form) }}
        </div>
        <div id="box">
            <form action="{{ path('homepage') }}" method="post" {{ form_enctype(form) }}>

                {#{ form_errors(form.texto) }#}
                {{ form_widget(form.texto, { 'attr': {'placeholder': 'Comparte tu secreto, anécdota o un mensaje al mundo...'} }) }}

                <div id="options">

                    {{ form_label(form.tipo) }}
                    {{ form_widget(form.tipo) }}

                    <div id="right_options">

                    </div>

                </div>

                {{ form_rest(form) }}

                <div id="box_bottom">

                    <p>Caracteres: <span id="count_caracteres">555</span></p>

                    <input type="submit" value="Compartir" class="Button" />

                </div>

            </form>
        </div>

        <div id="stream">
            {% for mensaje in ultimos_contenidos %}

                <div class="Box_contenido">
                    <div class="Titulo">{{ mensaje.tipo | replace({'s': "Secreto", 'a': "Anécdota", 'm': "Mensaje"})  }} / {{ mensaje.fechaCreacion | date('d.m.y') }}</div>
                    <div class="Contenido">{{ mensaje.texto }}</div>
                    <div class="Datos">
                        {# Comentarios: {{ mensaje.comentarios | length }} #}
                        {% if mensaje.comentarios | length > 0 %}

                            {% for comentario in mensaje.comentarios %}

                                {{ comentario.texto }}<hr/>

                            {%endfor%}

                        {% else %}
                            No hay comentarios
                        {% endif %}

                        <br/>
                        <form action="{{ path('vista_contenido', {'id': mensaje.id, 'titulo': '', 'tipo': mensaje.tipo}) }}" method="post" {{ form_enctype(forms_comentario[loop.index]) }}>

                            {{ form_errors(forms_comentario[loop.index]) }}

                            {{ form_rest(forms_comentario[loop.index]) }}

                            <!--input type="submit" value="Comentar" /-->

                        </form>

                    </div>
                </div>

            {% else %}

                <p>No hay mensajes aún</p>

            {% endfor %}
        </div>
    </div>

{% endblock %}

{% block right %} <script type="text/javascript"><!--
google_ad_client = "ca-pub-4717880844454319";
/* Adsense1 */
google_ad_slot = "4216094893";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script> {% endblock%}

{% block javascripts %}
    <script type="text/javascript">

        $(document).ready(function(){

            $('#contenido_texto').keyup(function() {
                textChange();
            });

            $('#contenido_texto').keydown(function() {
                textChange();
            });

            $('input[name="comentario[texto]"]').each(function(index) {
                $(this).attr("placeholder","deja tu comentario...");
                $(this).css("border", "1px solid #929191")
                        .css("width", "260px");
                $(this).keypress(function(event) {
                    if ( event.which == 13 ) {
                        $(this).parent().parent().submit();
                    }
                });
            });

        });

        function textChange() {
            var area = $('#contenido_texto');
            var num = $('#count_caracteres');
            var valor = 555 - area.val().length;
            num.text(valor);
        }

    </script>
{% endblock %}
