{% extends 'MondelCuentaloBundle::layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets '@MondelCuentaloBundle/Resources/public/css/index.css' filter='yui_css' %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}
{% block content %}
    {{ parent() }}
    <div class="Wrap">
        <div id="box">
            <form id="contenido_form" action="{{ path('_contenido_crear') }}" method="post" {{ form_enctype(form) }}>
                {{ form_widget(form.texto, { 'attr': { 'placeholder': 'Comparte tu secreto, anécdota o un mensaje al mundo...' } }) }}
                <div id="options">
                    {% if not is_granted('ROLE_USER') %}
                        {{ form_label(form.sexo) }}
                        {{ form_widget(form.sexo) }}
                    {% endif %}
                    {{ form_label(form.categoria) }}
                    {{ form_widget(form.categoria) }}
                </div>
                {{ form_widget(form._token) }}
                <div id="box_bottom">
                    <p>Caracteres: <span id="count_caracteres">555</span></p>
                    <input type="submit" value="Compartir" class="ButtonShare" />
                </div>
            </form>
        </div>
        <div id="stream">
            {% for mensaje in contenidos %}
                <div class="Post">
                    <div class="Titulo">
                        {% if mensaje.usuario != null %}
                            {% if mensaje.usuario.sexo == 'm' %}
                                <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/masculino.png') }}" />
                            {% else %}
                                <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/femenino.png') }}" />
                            {% endif %}
                        {% else %}
                            {% if mensaje.sexo != null %}
                                {% if mensaje.sexo == 'm' %}
                                    <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/masculino.png') }}" />
                                {% else %}
                                    <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/femenino.png') }}" />
                                {% endif %}
                            {% endif %}
                        {% endif %}
                        {{ mensaje.categoria.nombre }}
                        -
                        {{ mensaje.fechaCreacion | created_ago }}
                        <span class="InfoTitulo">
                            X
                        </span>
                    </div>
                    <div class="Contenido">{{ mensaje.texto }}</div>
                    <div class="Datos">
                        <div class="TituloComentarios">Comentarios</div>
                        <div class="Comentarios">
                            {% if is_granted('ROLE_USER') %}
                                {% if mensaje.comentarios | length > 0 %}
                                    {% for comentario in mensaje.comentarios %}
                                        {% if comentario.usuario.sexo == 'm' %}
                                            <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/masculino.png') }}" />
                                        {% else %}
                                            <img class="IconoSexo" src="{{ asset('bundles/mondelcuentalo/img/femenino.png') }}" />
                                        {% endif %}
                                        {{ comentario.usuario.nombre }}:
                                        {{ comentario.texto }}
                                        <br/>
                                        {{ comentario.fechaCreacion | created_ago }}
                                        {% if not loop.last %}
                                            <hr/>
                                        {% endif %}
                                    {%endfor%}
                                {% else %}
                                    No hay comentarios
                                {% endif %}
                                <br/>
                                <form action="{{ path('_contenido_comentar', {'id': mensaje.id}) }}" method="post" {{ form_enctype(formularios_comentarios[mensaje.id]) }}>
                                    {{ form_errors(formularios_comentarios[mensaje.id]) }}
                                    {{ form_widget(formularios_comentarios[mensaje.id].texto, { 'attr': {'placeholder': 'deja tu comentario...'} }) }}
                                    {{ form_rest(formularios_comentarios[mensaje.id]) }}
                                </form>
                            {% else %}
                                Para ver los comentarios debes estar <a href="{{ path('_registrar') }}">registrado</a> o <a href="{{ path('_ingresar') }}">iniciar sesi&oacute;n</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <p>No hay mensajes aún</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% javascripts '@MondelCuentaloBundle/Resources/public/js/functions.js' filter='yui_js' %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}
